(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};App.CommentView=function(t){function r(){return this.addReply=e(this.addReply,this),this.toggleCommentArrow=e(this.toggleCommentArrow,this),this.toggleReplyList=e(this.toggleReplyList,this),this.showReplies=e(this.showReplies,this),this.loadReplies=e(this.loadReplies,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.tagName="li",r.prototype.className="comment",r.prototype.events={"click .allCommentLink":"showReplies","keyup .addReply":"addReply"},r.prototype.initialize=function(){return this.template=$("#comment-template").generateTemplate(),this.render()},r.prototype.render=function(){var e;return e=this.model.get("user_id"),this.model.set({user_icon:App.usersCollection.getThumb(e),user_name:App.usersCollection.getName(e),cuser_icon:App.currentUser.get("thumb_url")}),$(this.el).html(this.template(this.model.toJSON())),this.loadReplies(),$("#comments-list").prepend(this.el),this.$(".timeago").timeago()},r.prototype.loadReplies=function(){var e,t;return t=this,e=App.replies.getCommentReplies(this.model.get("id")),e.length>0?(this.$(".allCommentLink").hide(),_.each(e,function(e){var n;return n=new App.ReplyView({model:e}),t.$(".reply-list ul").append(n.render())})):this.$(".reply-list").addClass("reply-list-closed")},r.prototype.showReplies=function(){return this.toggleReplyList(),this.toggleCommentArrow()},r.prototype.toggleReplyList=function(){var e;return e=this.$(".reply-list"),e.hasClass("reply-list-closed")?e.removeClass("reply-list-closed"):e.addClass("reply-list-closed")},r.prototype.toggleCommentArrow=function(){var e;return e=this.$(".allCommentLink .icon-chevron-down"),e.hasClass("icon-up")?e.removeClass("icon-up"):e.addClass("icon-up")},r.prototype.addReply=function(e){var t,n,r;r=this;if(e.keyCode===13)return this.$(".allCommentLink").hide(),t=this.$(".addReply").val().replace(/(\r\n|\n|\r)/gm,""),n={body:t,comment_id:this.model.get("id")},App.replies.create(n,{success:function(e){var t;return t=new App.ReplyView({model:e}),r.$(".reply-list ul").append(t.render()),$(".timeago").timeago()}}),this.$(".addReply").val("")},r}(Backbone.View)}).call(this);
(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};App.DreamLog=function(t){function r(){return this.updateVotes=e(this.updateVotes,this),this.heartFull=e(this.heartFull,this),this.heartEmpty=e(this.heartEmpty,this),this.voteHandler=e(this.voteHandler,this),this.addComment=e(this.addComment,this),this.showComments=e(this.showComments,this),this.showRead=e(this.showRead,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.el="#dreamLog",r.prototype.events={"click .dreamLog_closeButton":"close","click #read":"showRead","click #comments":"showComments","keyup #addComment":"addComment","click #vote":"voteHandler"},r.prototype.initialize=function(){return this.template=$("#dreamLog-template").generateTemplate()},r.prototype.load=function(e){var t,n;return n=this,this.log=e,t=e.toJSON(),t.cuser_icon=App.currentUser.get("thumb_url"),setTimeout(function(){var r;return $(n.el).html(n.template(t)),n.updateVotes(),r=App.comments.getLogComments(e.get("id")),_.each(r,function(e){return new App.CommentView({model:e})})},500)},r.prototype.open=function(){return this.isOpen()?this.flash():$(this.el).removeClass("dreamLog_closed")},r.prototype.close=function(){return App.editMode||this.clearActive(),$(this.el).addClass("dreamLog_closed")},r.prototype.flash=function(){return $(this.el).flashDiv()},r.prototype.isOpen=function(){return $(this.el).hasClass("dreamLog_closed")?!1:!0},r.prototype.clearActive=function(){return $(".showDreamArrow").removeClass("showDreamArrow"),$(".dreamActive").removeClass("dreamActive"),$(".showProfileImg").removeClass("showProfileImg"),$(".dreamDateFades").removeClass("dreamDateFades")},r.prototype.showRead=function(){return $(".comment-wrap").removeClass("showComments"),$(".dream_content").addClass("showRead")},r.prototype.showComments=function(){return $(".comment-wrap").addClass("showComments"),$(".dream_content").removeClass("showRead")},r.prototype.addComment=function(e){var t,n;if(e.keyCode===13)return t=$("#addComment").val().replace(/(\r\n|\n|\r)/gm,""),n={body:t,log_id:this.log.id},App.comments.create(n,{success:function(e){return new App.CommentView({model:e})}}),$("#addComment").val("")},r.prototype.voteHandler=function(){var e,t;return e={log_id:this.log.get("id"),user_id:App.currentUser.get("id")},t=App.votes.where(e),console.log(App.currentUser),t.length>0?App.votes.remove(t[0]):App.votes.create(e),this.updateVotes()},r.prototype.heartEmpty=function(){return $("#vote i").removeClass("icon-heart"),$("#vote i").addClass("icon-heart-empty")},r.prototype.heartFull=function(){return $("#vote i").removeClass("icon-heart-empty"),$("#vote i").addClass("icon-heart")},r.prototype.updateVotes=function(){var e;return e=App.votes.getVotes(this.log.get("id")),$("#voteCount").html(e.count),this.log.set({vote_counts:e.count}),e.userVote?this.heartFull():this.heartEmpty()},r}(Backbone.View)}).call(this);